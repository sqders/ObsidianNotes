# Определение
**Взаимная блокировка** или ***Deadlock*** - это ситуация, когда **потоки взаимно заблокировали необходимые для работы обоих потоков ресурсы**. И потоки вечно ждут разблокировки этих ресурсов, которая никогда не произойдет, т.к. потоки ожидают освобождение ресурсов, которое никогда не наступит.

Чаще всего такая ситуация происходит при синхронизации потоков на ресурсах в разном порядке.
# Как избежать
1) Не допускать забирание локов в разных порядках.
2) Если логика программы требует забирать локи в разном порядке, то используйте [[ReentrantLock]], а не [[Synchronized]]. Суть в том, чтобы перенести локи в отдельный метод и разблокировать ресурс, если какой-либо `lock` уже занят.
# Пример
![[Pasted image 20230604130656.png]]
**fixed:**
![[Pasted image 20230604131449.png]]
Также можно добавить `Thread.sleep(1)`, чтобы дать другому потоку время на блокирование двух ресурсов.
И теперь вызовы локов выглядят так:
![[Pasted image 20230604131727.png]]