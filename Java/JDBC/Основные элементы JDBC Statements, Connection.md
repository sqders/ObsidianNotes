# Connection
`Connection` - Один из основных классов для работы с БД из кода Java с помощью JDBC. Connection создает после указания драйвера, который будет использован и на вход принимает необходимые параметры для открытия соединения с БД (**url, username, password**, описано в [[Основы JDBC]]), с помощью заранее определенного драйвера, создается `Connection`, который представляет собой соединения с БД, с его помощью, можно создавать `Statements`, которые уже являются запросами к БД.
## Получение Connection
Чтобы получить объект Connection, необходимо иметь 3 вещи:
1. **URL** БД, к которой мы хотим подключиться
2. **username** пользователя БД, который имеет доступ к ней
3. **password** этого пользователя
Получить объект Connection можно, обратившись к классу `DriverManager` и его статическому методу `DriverManager.getConnection(url,username,password)`, который, используя зарегистрированный заранее `Driver JDBC`, например, **MySQL-драйвер**, возвращает connection.
Объект `Connection` обязательно должен быть закрыт и может быть объявлен в блоке **`try` с ресурсами**
# Statements
`Statements` получаются из объекта класса `Connection` и необходимы **для обращения к БД с запросами**. Должны быть закрыты и могут (и должны) использоваться **внутри блока `try` с ресурсами**
## Statements (обычные)
Statements позволяют нам выполнять запросы к БД, они не могут быть изменены и чаще всего используются для общих запросов, параметры которых не изменяются. В принципе, редко используются в реальных проектах.
### Пример
Выбор всех значений из БД / извлечение известного на этапе компиляции объекта. Можно использовать `Statement` для исполнения запроса с параметрами, которые ввёл пользователь, однако это подвергает программу ошибкам из-за инъекций. Для борьбы с ними служит класс `PreparedStatement`, описанный ниже.
![[Pasted image 20230622134616.png]]
## PreparedStatements
`PreparedStatement` - это класс, объект которого создается из объекта `Connection`, он позволяет исполнять SQL-команды из Java кода, включая вставку значений в заранее определенные для этого места SQL-запроса, что позволяет изменять SQL-запрос корректно, избегая [[SQL - injections инъекции|инъекций]]
### Почему это необходимо?
Возьмем простейших подход с конкатенацией строк в запросе:
![[Pasted image 20230622133412.png]]
Данный код просто вставляет всю строку `userId` прям в SQL-запрос. Чем это может быть чревато? Можно подставить инъекцию вместо корректного `userId`. Именно поэтому нам просто необходимо конкретно определять, **ЧТО** и **КУДА** мы хотим вставить и валидировать, корректные ли данные подаются на вход.
### Пример `PreparedStatement`
В коде это выглядит вот так:
![[Pasted image 20230622133632.png]]
Знак `?` означает, что на этом месте могут быть подставлены какие-то данные. Как же их валидировать? Это осуществляет при помощи как раз объекта класса `PreparedStatement`:
![[Pasted image 20230622133828.png]]
Мы явно указываем, какой тип мы хотим видеть на нужной нам позиции вставки данных - соответствующего знака `?` в запросе, **подсчёт которых идёт с 1**. Тут даже `setString()` не позволяет нам никак добавлять SQL-инъекции, так что такой код безопасен и может быть исполнен корректно.
### Использование
1. Создаем объект `PreparedStatement` из `Connection`, передаем ему SQL-запрос
2. Заполняем ВСЕ поля, которые необходимы (Все знаки `?` в запросе) методами `.set`
3. Выполняем запрос, вызывая метод `.executeQuery()` или `.executeUpdate()`
   ![[Pasted image 20230622134312.png]]